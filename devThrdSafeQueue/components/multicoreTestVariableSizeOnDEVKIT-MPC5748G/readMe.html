<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Peter Vranken">
<title>safe-RTOS (VLE) - A simple RTOS with safety support for MPC5748G</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1><span class="image"><img src="doc/manual/theme/iconSafeRTOS-asColoredIcon.jpg" alt="iconSafeRTOS asColoredIcon" width="3%"></span> safe-RTOS (VLE) - A simple RTOS with safety support for MPC5748G</h1>
<div class="details">
<span id="author" class="author">Peter Vranken</span><br>
<span id="email" class="email">mailto:Peter_Vranken@Yahoo.de</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about_this_devkit_mpc5748g_sample">1. About this DEVKIT-MPC5748G sample</a></li>
<li><a href="#_the_rtos">2. The RTOS</a></li>
<li><a href="#_the_safety_concept">3. The safety concept</a>
<ul class="sectlevel2">
<li><a href="#_technical_concept">3.1. Technical concept</a></li>
<li><a href="#_self_diagnosis_of_the_kernel">3.2. Self-diagnosis of the kernel</a></li>
<li><a href="#_kernel_vs_operating_system">3.3. Kernel vs. Operating System</a></li>
<li><a href="#_architecture_of_application_code">3.4. Architecture of application code</a></li>
</ul>
</li>
<li><a href="#_tools">4. Tools</a>
<ul class="sectlevel2">
<li><a href="#_environment">4.1. Environment</a></li>
<li><a href="#_compiler_and_makefile">4.2. Compiler and makefile</a></li>
<li><a href="#secRunInRAM">4.3. Running your application in RAM</a></li>
<li><a href="#_flashing_and_debugging">4.4. Flashing and debugging</a></li>
</ul>
</li>
<li><a href="#_code_architecture">5. Code architecture</a>
<ul class="sectlevel2">
<li><a href="#_book_e_versus_vle">5.1. Book E versus VLE</a></li>
</ul>
</li>
<li><a href="#_known_issues">6. Known issues</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title=":fire:"></i>
</td>
<td class="content">
This readme file basically is a copy from the ancestor project,
which had been published for the MPC5643L. The text has not been revised
for the new context yet. It&#8217;ll still contains many references to the
single core solution MPC5643L.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_this_devkit_mpc5748g_sample">1. About this DEVKIT-MPC5748G sample</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This DEVKIT-MPC5748G sample implements an easy to reuse RTOS
for the NXP MPC5748G and other microcontroller derivates with e200z4/7
core. The RTOS has been designed with respect to the demands of
safety-critical embedded software. The concept of processes has been
adopted with the intention of running applications of different
criticality levels in different processes without fearing harmful
interferences between them. Features of the RTOS are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Preemptive, priority controlled scheduling</p>
</li>
<li>
<p>The kernel can run on any core, decided independently for each core</p>
<div class="ulist">
<ul>
<li>
<p>Many basic services are available even on cores, which are not
configured to run safe-RTOS. This relates to interrupt handling and
synchronization</p>
</li>
</ul>
</div>
</li>
<li>
<p>Up to five processes (including kernel) with disjunct memory address
spaces and hierarchic privileges</p>
</li>
<li>
<p>Tasks belong to processes and share the process owned memories</p>
</li>
<li>
<p>Processes are basically shared by the cores. The cores may run their
tasks in same or in disjunct processes</p>
</li>
<li>
<p>Communication services</p>
<div class="ulist">
<ul>
<li>
<p>Secured priority ceiling protocol for inter-task communication on a
core</p>
</li>
<li>
<p>Inter-process function calls for communication between processes on a
core</p>
</li>
<li>
<p>Shared memory</p>
<div class="ulist">
<ul>
<li>
<p>Sharing between tasks of same process but running on different cores</p>
</li>
<li>
<p>Sharing between different processes</p>
</li>
</ul>
</div>
</li>
<li>
<p>Inter-core notification service for sending events and messages from
core to core</p>
</li>
<li>
<p>Inter-core mutex operations</p>
</li>
</ul>
</div>
</li>
<li>
<p>Hardware memory protection to ensure integrity of process owned memories</p>
</li>
<li>
<p>Deadline monitoring and activation loss counters for avoidance of
blocking tasks</p>
</li>
<li>
<p>Exception handling to catch failures like use of privileged, illegal or
misaligned instructions or forbidden access to memory or I/O</p>
</li>
<li>
<p>Diagnostic API to gather information about failing processes and the
possibility to halt critical processes</p>
</li>
<li>
<p>I/O driver model for safe implementation of a complete operating system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The RTOS itself is not a runnable piece of software. It requires some
application code. The folder <code>code\application</code> contains several sample
applications for the RTOS. The build scripts take the name of a sample
application as an argument and link the selected application with the
RTOS into a flushable, runnable and debugable binary file.</p>
</div>
<div class="paragraph">
<p>To see how the samples work you need to open a terminal software on your
host machine. You can find a terminal as part of the CodeWarrior Eclipse
IDE; go to the menu, "Window/Show View/Other/Terminal/Terminal".</p>
</div>
<div class="paragraph">
<p>Open the serial port, which is offered by the DEVKIT-MPC5748G. (On
Windows, open the Computer Management and go to the Device Manager to find
out.) The Baud rate has been selected as 115200 Bd in function <code>main</code>, 8
Bit, no parity, 1 start and stop Bit. The terminal should print the
messages, which are regularly sent by the sample code running on the
evaluation board. Selected samples may even take some input.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_rtos">2. The RTOS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The proposed RTOS is little exciting with respect to its functionality.
The scheduler implements the functionality of what is called the "Basic
Conformance Class 1" (BCC1) of the OSEK/VDX-OS standard and of its BCC2 with
the exception of activation queuing.</p>
</div>
<div class="paragraph">
<p>The scheduler offers an API to create events that can activate tasks. An
event is either a regular timer event, triggered by the RTOS system clock,
a notification from another core or a software triggered event. The latter
can be triggered either from user code (if it has sufficient privileges)
or from ISRs belonging to the operating system.</p>
</div>
<div class="paragraph">
<p>The RTOS offers a pre-configured set of up to four processes. The
limitation to four is a hardware constraint and for sake of simplicity no
virtualization by software has been shaped.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
  The operating system forms a fifth process. The operating system startup
code will register the needed tasks. The registration assigns them to one
of the processes and associates them with one of the created events.</p>
</div>
<div class="paragraph">
<p>All scheduling is strictly priority controlled. The triggering of an event
makes all associated tasks ready to run. This is called task activation.
At any time, the scheduler decides by priority, which of the <em>ready</em> tasks
becomes the one and only <em>running</em> task. This may involve preemption of
tasks.</p>
</div>
<div class="paragraph">
<p>The operating system startup code can install needed interrupt service
routines (ISR).</p>
</div>
<div class="paragraph">
<p>For mutual exclusion of tasks on a core, if shared data is involved, a
lock API is offered that implements the priority ceiling protocol (PCP).
It is secured so that supervisory tasks cannot be accidentally or
purposely blocked by application code.</p>
</div>
<div class="paragraph">
<p>The mechanisms already known from the other DEVKIT-MPC5748G sample
"startup" to suspend and resume all interrupts are still supported but
they are no longer offered to application code, only the operating system
may use them (mainly for I/O driver implementation).</p>
</div>
<div class="paragraph">
<p>The use of the RTOS is further supported by some diagnostic functions.
They offer stack usage information, information about caught exceptions
and averaged CPU load information. The diagnostics comes along with an
API to halt the execution of a process. Permission to use this API is
granted only to what is considered the safety process or task.</p>
</div>
<div class="paragraph">
<p>Many more details can be found in the manual, which is available
<a href="https://github.com/PeterVranken/DEVKIT-MPC5748G/blob/samples/safe-RTOS/doc/manual/readMe.adoc" target="_blank" rel="noopener">online</a>
in GitHub or as
<a href="https://github.com/PeterVranken/DEVKIT-MPC5748G/blob/samples/safe-RTOS/doc/manual/manual.pdf" target="_blank" rel="noopener">printable</a>
document. The API is described in the online <a href="https://htmlpreview.github.io/?https://raw.githubusercontent.com/PeterVranken/DEVKIT-MPC5748G/samples/safe-RTOS/doc/doxygen/html/globals_func.html">Doxygen help</a>, too.</p>
</div>
<div class="paragraph">
<p>The architecture of the RTOS is very simple and resembles its ancestors,
which were the simple RTOS without safety concept and safe-RTOS-VLE with
hardware scheduler (still provided only for MPC5643L). This simplicity
significantly supports the validation of the code in a safety-critical
software development environment.</p>
</div>
<div class="paragraph">
<p>For an explanation of the scheduling scheme, you may still refer to the
documentation of the simple RTOS, please look
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/tree/safe-RTOS-swScheduler/LSM/RTOS-VLE#The-RTOS" target="_blank" rel="noopener">here (for MPC5643L)</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_safety_concept">3. The safety concept</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This sections aims at giving an overview on the safety concept. Technical
details can be found in the manual of the RTOS.</p>
</div>
<div class="paragraph">
<p>A typical nowadays embedded project consists of a lot of code coming from
various sources. There may be an Open Source Ethernet stack, an Open
Source Web server plus self-made Web services, there may be an Open Source
driver software for a high resolution LCD, a framework for GUIs plus a
self-designed GUI, there needs to be the self-made system control software,
possibly a file system for data logging on an SMD storage, the C
libraries are used, and so on. All in all many hundred thousand lines of
code.</p>
</div>
<div class="paragraph">
<p>If the system can reach a state, which is potentially harmful to people or
hardware, then it&#8217;ll typically need some supervisory software, too, which
has the only aim of avoiding such a state. Most typical, the supervisory
software can be kept very lean. It may e.g. be sufficient to read a
temperature sensor, check the temperature against a boundary and to
control the coil of the main relay, which powers the system. If the
temperature exceeds a limit or if the temperature reading is somehow
implausible then the relay is switched off and the entire system
unpowered. That&#8217;s all. A few hundred lines of code can already suffice
for such a task.</p>
</div>
<div class="paragraph">
<p>All the rest of the software is not safety relevant. A fault in this
majority of code may lead to wrong system behavior, customer
dissatisfaction, loss of money, frustration, etc. but will not endanger
the safety of the system or the people using it.</p>
</div>
<div class="paragraph">
<p>If we rate the safety goal higher than the rest then we have a significant
gain in terms of development effort if we can ensure that the few hundred
lines of supervisory code will surely work always well and even despite of
potential failures of the rest of the code. Without the constraint
"despite of" we had to ensure "working always well" for all the many
hundred thousand lines of code.</p>
</div>
<div class="paragraph">
<p>Using a safety-aware RTOS can be one means to ensure this. The supervisory
code is put into a process of higher privileges and the hundred thousands
of lines of other code are placed into a separate process with lower
privileges. (Only) RTOS and supervisory code need to be carefully
reviewed, tested, validated to guarantee the "working always well" of the
supervisory code. Using a "normal" RTOS, where a fault in any part of the
code can crash the entire software system, the effort for reviews, tests
and validation needed to be extended to all of the many hundred thousand
lines of code. The economic difference and the much higher risk of not
discovering a fault are evident.</p>
</div>
<div class="paragraph">
<p>These basic considerations result in a single top-level requirement for
our safe-RTOS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the implementation of a task, which is meant the supervisory or
safety task, is itself free of faults then the RTOS shall guarantee that
this task is correctly and timely executed regardless of whatever
imaginable failures are made by any other process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requirement serves at the same time as the definition of the term
"safe", when used in the context of this RTOS. safe-RTOS promises no more
than this requirement says. As a consequence, a software made with this
RTOS is not necessarily safe and even if it is then the system using that
software is still not necessarily safe. Here, we just deal with the tiny
contribution an operating system kernel can make to a safe system.</p>
</div>
<div class="paragraph">
<p>All other technical requirements are derived from this one.</p>
</div>
<div class="sect2">
<h3 id="_technical_concept">3.1. Technical concept</h3>
<div class="paragraph">
<p>The basic idea of safe-RTOS is to organize all user tasks in groups of
such, the processes. Each process has write-access to its own, disjunct
RAM areas. (And to one additional shared area, which all processes have
write access to.) Writing to any other address of the address space is a
privilege violation.</p>
</div>
<div class="paragraph">
<p>Reading RAM and ROM is known to be free of side-effects and can&#8217;t do any
harm to another process&#8201;&#8212;&#8201;it&#8217;s therefore generally permitted.</p>
</div>
<div class="paragraph">
<p>Reading non-user MCU registers (CPU supervisor registers and I/O
registers) can have side-effects and is therefore generally forbidden. Any
attempt to do so is considered a privilege violation.</p>
</div>
<div class="paragraph">
<p>Any attempt to write to a non-user MCU register (CPU supervisor register
or I/O register) is considered a privilege violation.</p>
</div>
<div class="paragraph">
<p>API functions that control the behavior of other tasks or processes are
restricted to the use of certain processes. Any attempt of another process
to make use of such an API is a privilege violation. The most prominent
example is the API to halt the execution of a process.</p>
</div>
<div class="paragraph">
<p>Any privilege violation is punished by immediate abortion of the causing
task and in particular before the according instruction can have a
side-effect on not-owned RAM or CPU or I/O registers. The abortion is
counted with cause in the global process data.</p>
</div>
<div class="paragraph">
<p>The abortion of a task has no impact on future activations. The same task
will be activated again as soon as the event is triggered again, which the
task is associated with. If the task has a static error then it may easily
end up with an endless cycle of task activations and task abortions.</p>
</div>
<div class="paragraph">
<p>The kernel will never do more than immediately aborting a failing task.
It&#8217;ll not take any decision like: "Enough is enough, we are going to stop
that." Instead, it offers the mechanisms to implement such decisions in a
particular supervisory task.</p>
</div>
<div class="paragraph">
<p>The implementation of recognizing privilege violations before they can
harm is founded on the memory management unit (MMU) in the CPU,<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>
  the memory protection unit of the CPU-external buses and the CPU&#8217;s
exception mechanism. It&#8217;s impossible for a user task to change the
behavior of the MPU as its registers are in the address space it itself
protects. It is impossible for user code to change the behavior of MMU or
CPU exception handling; these settings are held in CPU supervisor
registers, which cannot be accessed without an immediately punished
privilege violation.</p>
</div>
<div class="paragraph">
<p>Note, the execution of code in ROM is generally not restricted. A task may
even call operating system code routines&#8201;&#8212;&#8201;until the executed code would
have a side-effect on not-owned RAM or on supervisor or I/O registers
(which it&#8217;ll normally have very soon). Then a privilege violation is
detected and the task is aborted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_self_diagnosis_of_the_kernel">3.2. Self-diagnosis of the kernel</h3>
<div class="paragraph">
<p>The RTOS offers an all-embracing concept for recognizing failures of the
user tasks and for hindering these failures from doing any harm. By
principle, the kernel can&#8217;t offer such a concept for its own
implementation, too. Nonetheless, there is a thin layer of self-diagnosis
and protection against kernel implementation faults. The exception
handlers inspect the exception throwing context to prove that this context
belongs to the user task code. According to our concept this will always
be the case&#8201;&#8212;&#8201;except for implementation errors in the kernel itself (or in
an added I/O driver, see below) or, less likely but possible, because of a
sporadic hardware fault, e.g. caused by local chip overtemperature or
cosmic radiation. In which case the kernel simply stops working on the core.</p>
</div>
<div class="paragraph">
<p>Halting the software execution can be considered not breaking the safety
concept of the system; in a safe system, there will always be an external
(i.e. CPU unrelated) device, which permanently checks the alive status of
the software running on the CPU and this device will ensure the transition
of the system into the safe state.</p>
</div>
<div class="paragraph">
<p>Note, in contrast to faults caught in the user tasks this mechanism can
not guarantee that the failure has not yet done some harm before being
recognized.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kernel_vs_operating_system">3.3. Kernel vs. Operating System</h3>
<div class="paragraph">
<p>safe-RTOS implements an operating system kernel but not an operating
system (OS). Additional code has to be added to let it become an OS. The
majority of this code will be the configuration and setup of processes and
tasks and a set of I/O device drivers.</p>
</div>
<div class="paragraph">
<p>The implementation of such drivers needs to make use of privileged
instructions and needs to access the I/O address space, which both is not
allowed in user tasks. The safety concept can hence not be limited to the
RTOS. The considerations made for the RTOS and its implementation need to
be considered for the I/O driver implementation, too. The concept is that
the RTOS is not limited to the source code that implements it but it also
has an abstract layer: It comes along with a binding set of design rules
how to implement an I/O driver. These rules are called the "driver model".
Any programmer of an I/O driver, who disregards only a single rule will
break the entire safety concept and the RTOS implementation can&#8217;t help it.</p>
</div>
<div class="paragraph">
<p>safe-RTOS&#8217;s driver model specifies memory mapped drivers, safe callbacks
and system calls of three "conformance classes", basic, simple and full.
They offer a trade off between driver performance in terms of CPU load and
attainable behavior and ease of programming. The by far leanest and most
powerful "basic" implementation needs to be done in assembler, the other
two classes can be implemented in C.</p>
</div>
<div class="paragraph">
<p>Note, adding an I/O driver to the RTOS is not only a matter of complying
with the driver model. Any programming error can potentially break the
safety concept, too. Much of the I/O driver code is executed in the kernel
process and implementation faults can crash the entire software system
like it generally is for all code in a "normal" RTOS. The organization of
the development work needs to take care by planning and implementing
according quality assurance measures. (Organizational measures, which will
necessarily include the published source code of the RTOS itself.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture_of_application_code">3.4. Architecture of application code</h3>
<div class="paragraph">
<p>Provided all I/O drivers are implemented fully compliant with the driver
model and they have been successfully validated then we have a safe
operating system but still not a safe software. A further constraint is
that the application software makes correct use of the offered mechanisms.</p>
</div>
<div class="paragraph">
<p>The supervisory code shall be put into the process with highest
privileges. It can be that the outlined concept is implemented in a
recursive way and the supervisory code is in turn split into two
criticality levels, with a very lean watchdog functionality on top.
("Sub-ordinated main part of supervisory code still alive and
functioning?") In which case the watchdog would have highest privileges
followed by the main part of the supervisory code and both having higher
privileges as the supervised functional code.</p>
</div>
<div class="paragraph">
<p>The highest privileged safety code will run on a priority level, which cannot
be preempted by tasks belonging to processes of lower privileges and which
cannot be blocked by these tasks using the offered APIs for mutual
exclusion of tasks. (With other words, a task with low privileges cannot
shape a critical section with the task of highest privileges.)</p>
</div>
<div class="paragraph">
<p>The supervisory code will make use of the diagnostics APIs to see if the
functional code is executing well. It can in case halt the execution of
the failing process or otherwise ensure that the system doesn&#8217;t leave the
safe operation state.</p>
</div>
<div class="paragraph">
<p>The RTOS mechanisms guarantee that faults in the user code cannot do any
harm&#8201;&#8212;&#8201;but this relates only to the definition of "harm" in the RTOS
context: OS configuration, I/O configuration or state, memory of other
processes, timely execution of their tasks can&#8217;t be touched. The same
mechanisms can not hinder the user task code from doing all kind of
things, which are not harmful in this sense but still harmful to the
system under control. Not allowing this is of course a top-level
requirement of the aimed software. It needs to be tackled mainly by the
architecture of the software. Here&#8217;s a single example:</p>
</div>
<div class="paragraph">
<p>Commonly, the functional code in the software computes I/O commands, which
go to the I/O drivers and control the connected actuators&#8201;&#8212;&#8201;which can mean
a lot of harm if giving wrong commands. By application design it can be
easily ensured that a functional task runs first, followed by a
supervisory task and finally the OS owned I/O driver task executes. In
such an architecture the supervisory code would be put in the position to
double-check the I/O control commands&#8201;&#8212;&#8201;and override them if advisable&#8201;&#8212;&#8201;before these commands are executed by the finally running I/O task.</p>
</div>
<div class="paragraph">
<p>This is just meant a simple example. The point is that the RTOS only
offers the mechanisms to design a safe software but it can not undertake
for software safety.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools">4. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_environment">4.1. Environment</h3>
<div class="sect3">
<h4 id="_command_line_based_build">4.1.1. Command line based build</h4>
<div class="paragraph">
<p>The makefiles and related scripts require a few settings of the
environment in the host machine. In particular, the location of the GNU
compiler installation needs to be known and the PATH variable needs to
contain the paths to the required tools.</p>
</div>
<div class="paragraph">
<p>For Windows users there is a shortcut to PowerShell in the root of this
GitHub project, which opens the shell with the prepared environment.
Furthermore, it creates an alias to the appropriate GNU make executable.
You can simply type <code>make</code> from any location to run MinGW32 GNU make.</p>
</div>
<div class="paragraph">
<p>The PowerShell process reads the script <code>setEnv.ps1</code>, located in the
project root, too, to configure the environment. This script requires
customization prior to its first use. Windows users open it in a text
editor and follow the given instructions that are marked by TODO tags.
Mainly, it&#8217;s about specifying the installation directory of GCC.</p>
</div>
<div class="paragraph">
<p>Non-Windows users will read this script to see, which (few) environmental
settings are needed to successfully run the build and prepare an according
script for their native shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="secOpenEclipse">4.1.2. Eclipse for building, flashing and debugging</h4>
<div class="paragraph">
<p>Flashing and debugging is always done using the NXP S32 Design Studio for
Power Architecture, an Eclipse IDE, which is available for free download
und unrestricted use in commercial and non commercial projects.</p>
</div>
<div class="paragraph">
<p>If you are going to run the application build from the Eclipse IDE then
the same environmental settings as described above for a shell based build
need to be done for Eclipse, too. The easiest way to do so is starting
Eclipse from a shell, that has executed the script <code>setEnv.ps1</code> prior to
opening Eclipse.</p>
</div>
<div class="paragraph">
<p>For Windows users the script <code>S32DS-IDE.ps1</code> has been prepared. This script
requires customization prior to its first use. Windows users open it in a
text editor and follow the given instructions that are marked by TODO
tags. Mainly, it&#8217;s about specifying the installation directory of
the S32 Design Studio.</p>
</div>
<div class="paragraph">
<p>Non-Windows users will read this script to see, which (few) environmental
and path settings are needed to successfully run the build under control
of Eclipse and prepare an according script for their native shell.</p>
</div>
<div class="paragraph">
<p>Once everything is prepared, the S32 Design Studio will never be started
other than by clicking the script <code>S32DS-IDE.ps1</code> or its equivalent on
non-Windows hosts.</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/PeterVranken/TRK-USB-MPC5643L" target="_blank" rel="noopener">project overview</a> and
<a href="https://github.com/PeterVranken/TRK-USB-MPC5643L/wiki/Tools-and-Installation" target="_blank" rel="noopener">GitHub
Wiki</a> for more details about downloading and installing the required
tools.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compiler_and_makefile">4.2. Compiler and makefile</h3>
<div class="paragraph">
<p>Compilation and linkage are makefile controlled. The compiler is GCC
(MinGW-powerpc-eabivle-4.9.4). The compiler is part of the S32 Design
Studio installation and can be used independently from the Studio. The
makefile is made generic and can be reused for true, large projects that
want to make use of safe-RTOS. It supports a number of options (targets);
get an overview by typing:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd &lt;projectRoot&gt;/samples/safe-RTOS
mingw32-make help</pre>
</div>
</div>
<div class="paragraph">
<p>The main makefile <code>GNUmakefile</code> has been configured for the build of
sample "safe-RTOS" but the kernel can&#8217;t be linked into a runnable
binary without an application. You need to specify the source code path of
a safe-RTOS application on the command line of make. Set variable APP to
do so. Possible applications can be found as the children of folder
<code>&lt;projectRoot&gt;/samples/safe-RTOS/code/application</code>. Type
("code/application/default/" is just an example):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mingw32-make -sO build APP=code/application/default/
mingw32-make -sO build APP=code/application/default/ CONFIG=PRODUCTION</pre>
</div>
</div>
<div class="paragraph">
<p>to produce the flashable files
<code>bin\ppc\default\DEBUG\DEVKIT-MPC5748G-safe-RTOS.elf</code>, and
<code>bin\ppc\default\PRODUCTION\DEVKIT-MPC5748G-safe-RTOS.elf</code>.</p>
</div>
<div class="paragraph">
<p>To get more information, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mingw32-make --help
mingw32-make help</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
The makefile requires the MinGW port of the make processor. The
Cygwin port will fail with obscure, misleading error messages. For your
convenience, we have uplodaded an appropriate recent version of the MinGW
make processor into this GitHub project. The PowerShell startup script
aliases this (Windows) executable to the command <code>make</code>. Moreover,
explicitly typing <code>mingw32-make</code> will generally avoid any problem.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The makefile is designed to run on different host systems but has been
tested with Windows 7 and Windows 10 only.</p>
</div>
<div class="paragraph">
<p>Note, the Eclipse project configuration in the root folder of this
DEVKIT-MPC5748G sample (<code>.settings</code>, <code>.cproject</code>, <code>.project</code>) only
supports the build of a sub-set of the possible configurations. safe-RTOS
can be compiled with a few sample applications only, each of them in DEBUG
and PRODUCTION compilation. To build more samples with Eclipse you would
have to duplicate the existing build configurations and adapt the make
command lines in the build settings according to the explanations and
examples above.</p>
</div>
</div>
<div class="sect2">
<h3 id="secRunInRAM">4.3. Running your application in RAM</h3>
<div class="paragraph">
<p>The makefile and the linker scripts support the location of the code
entirely in RAM. The MPC5748G has plenty of RAM so that even large pieces
of code can be loaded and executed in RAM. This is extremely helpful for
code development. Loading the code into the device&#8217;s RAM is significantly faster
than into ROM and many flash erase and program cycles can be saved. Even
if your complete project may not fit into RAM then you may still consider
it useful to build some sub-modules together with their testing code in
this way.</p>
</div>
<div class="paragraph">
<p>Nothing particular has to be done to load a compiled software into RAM.
The GNU debugger in the Design Studio just looks at the addresses of code
and data objects in the binary file (<code>*.elf</code>). It&#8217;ll erase and flash the
ROM if the objects have ROM addresses and it&#8217;ll load them into RAM if the
objects are located in RAM. So all we have to do is defining the memory
addresses in the linker scripts accordingly in the one or the other way.</p>
</div>
<div class="paragraph">
<p>Under control of a macro in the main makefile, <code>GNUmakefile</code>, the linker
chooses different address ranges. If the macro <code>LINK_IN_RAM</code> is element of
the list of macros then the linker will divide the physically available
RAM into 67% for code or text and constant data sections (512k) and 33%
for data sections (256k). If the macro is not defined in the list then all
768k of RAM are available to the data sections.</p>
</div>
<div class="paragraph">
<p>The macro is seen by the C source code at compile-time, too. However,
there are barely dependencies. The MPU configuration is the principal
exception and some execution timing operations are dependent on the macro,
too.</p>
</div>
<div class="paragraph">
<p>To switch between linkage in ROM or RAM, open file <code>GNUmakefile</code> in a text
editor and look for the definition of variable <code>defineList</code>. The left hand
side expression is a blank-separated list of symbols, which are passed to
the compiler and linker as preprocessor #define. Add <code>LINK_IN_RAM</code> if
you want to run your code in RAM.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title=":fire:"></i>
</td>
<td class="content">
Running the software in RAM is useful but, by principle, a
preliminary, temporary way of working only. Running the software can be done
only under control of the debugger, which is needed to load the binary
data into the MCU&#8217;s RAM. A start of the software out of reset or after a
power-up or without connected Design Studio is impossible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_flashing_and_debugging">4.4. Flashing and debugging</h3>
<div class="paragraph">
<p>The code of this DEVKIT-MPC5748G sample can be flashed and debugged with
the S32 Design Studio IDE. Effectively, flashing means to start the GNU
debugger (GDB) and to let it "load" the *.elf file. If the code is linked
in flash ROM address space then this loading means writing to the flash.
Consequently, a flash configuration in the Eclipse IDE is nearly identical
to any ordinary debug configuration, just the option "Load executable" to
load a file is checked. Normal debug configurations, i.e. for debugging,
don&#8217;t have this check mark set:</p>
</div>
<div id="figDebugConfigFlash" class="imageblock text-center">
<div class="content">
<img src="readMe_resources/debugConfigForFlashing.jpg" alt="Eclipse debug configuration" width="70%">
</div>
<div class="title">Figure 1. Eclipse debug configuration, which is used for flashing</div>
</div>
<div class="paragraph">
<p>Connect your evaluation board DEVKIT-MPC5748G with the USB wire and start
the S32 Design Studio as outlined above (<a href="#secOpenEclipse">Section 4.1.2</a>). Now you can
find the debug configuration shown in <a href="#figDebugConfigFlash">Figure 1</a> in menu
"Run/Debug Configurations&#8230;&#8203;" A dialog listing all available debug
configurations opens. Type "flash" in the text box, which initially has
the focus, to filter all of them, which are intended for flashing and
select the one you need. Press the Enter key or click on button
"Debug" and the flash process begins. The progress is printed in one of
the console windows in the lower right corner.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a bit counter-intuitive that flashing with GDB is just a kind of side
effect of starting the debugger. Rather than with a "Congratulations,
flashing successfully completed"-message, flashing ends with a ready to
use interactive debug session: The source code window shows the startup
code for the boot core Z4A and you could go ahead and step through the
just flashed code. However, you won&#8217;t typically do so and rather stop this
debug session again. This is why:</p>
</div>
<div class="paragraph">
<p>In the S32 Design Studio, a debug session for projects running <em>n</em> cores
requires opening a combination of <em>n</em> Eclipse debug configurations, one
for each core. Such a combination is called a "Launch Group". Our flash
configurations generally use only a single debug configuration, because
our project links all the code in one *.elf file, regardless of the number
of cores, which are in use. Therefore, if you&#8217;d really go ahead with the
flash debug session then you could only control and observe boot core Z4A.
Better to close it again and start a more appropriate Launch Group, like
"triCore (all cores, DEBUG)".</p>
</div>
<div id="figLaunchGroup" class="imageblock text-center">
<div class="content">
<img src="readMe_resources/debugLaunchGroup.jpg" alt="Debug configuration to chose when debugging a multi-core software" width="70%">
</div>
<div class="title">Figure 2. Debug configuration to chose when debugging a multi-core software</div>
</div>
<div class="paragraph">
<p>If you built your software for execution in RAM (see <a href="#secRunInRAM">Section 4.3</a>) then
you don&#8217;t need to flash. No matter what is currently flashed, just start
the according debug configuration. The RAM is loaded with your software
and you can start it with the usual debugger commands to step and run,
etc. If you end the debug session while the cores are all running (i.e.
none of the cores is halted in a breakpoint) then the software in RAM even
stays alive and can be observed without debugger connection. Only after
next reset the ROM software will take effect again.</p>
</div>
<div class="paragraph">
<p>By the way, the debug sessions can be found also by a click on the black
triangle next to the blue icon "bug". The last recently used
configurations are listed in the menu. To see all of them or to
double-check their properties you&#8217;d click "Debug Configurations&#8230;&#8203;",
somewhere down below the list. In the new dialog, select the wanted one
and start the debugger with a last click on button "Debug".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_architecture">5. Code architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_book_e_versus_vle">5.1. Book E versus VLE</h3>
<div class="paragraph">
<p>Only VLE code is supported.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_issues">6. Known issues</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Debugger: If the view shows the INTC0 register set then the debugger
harmfully affects program execution and the RTOS fails: The write to
INTC_EOIR_PRC0, which normally restores the current priority level
INTC_CPR_PRC0, now fails to do so. The complete interrupt handling fails
from now on. Mostly the effect is that the OS tick interrupt, which has a
high priority, leaves this high priority level set in the INTC_CPR_PRC0,
so that effectively no interrupts (including itself) are handled any more.
Only the code of the idle task is executed any longer.</p>
<div class="paragraph">
<p>Workaround: Don&#8217;t open the view of the INTC0 in the debugger when
debugging a safe-RTOS application. Then the INTC and the code work fine.</p>
</div>
</li>
<li>
<p>Debugger: A similar effect has been observed with the instructions to
alter the External Interrupt enable bit, MSR[EE]. Do not single-step in
the debugger over wrtee(i) instructions. The instruction may fail to
change the bit. If the code approaches such an instruction you should use
the right-click operation "Run to line", targeting the instruction behind
the wrtee(i). This works fine.</p>
</li>
<li>
<p>Debugger: A similar effect has been observed when putting a breakpoint
on the first instruction of an exception handler. (Which is indeed a
natural desire to be informed about exceptions.) The correct exception
handling is confused. The CPU state is not correctly stored in the xSRRi
registers and the MSR bits are not properly updated, at least not the
External Interrupt enable bit, MSR[EE]. Further software execution has
barely a chance. Workaround is to set the breakpoint a few instructions
further on in the exception handler.</p>
</li>
<li>
<p>Debugger: It is not possible to hinder the P&amp;E debugger from halting at
an se_illegal instruction. (See <a href="https://community.nxp.com/thread/497533" class="bare">https://community.nxp.com/thread/497533</a>)
This makes it impossible to debug the fault catching capabilities of the
RTOS. All severe code errors, which lead to the execution of an arbitrary
address, will sooner or later encounter a zero word in the instruction
stream and the debugger will break&#8201;&#8212;&#8201;before the RTOS can catch the error.
It is possible to continue the code execution from the debugger and to
see, what the RTOS will do but this is an interactive process and
systematic testing of error catching code is not possible this way. We can
only do it without connected debugger.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. With some limitation even more processes can be defined. The more processes the more painful the limitations are. More than six processes becomes unrealistic.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This holds in general but not for the MPC5748G, which doesn&#8217;t have an MMU. Here, memory protection is ensured only by the SMPU.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-06-10 22:59:53 +0200
</div>
</div>
</body>
</html>